console.log("Script add-bug.js was loaded");
console.log("-----------------");

//
// promptCourseInformation
//
function promptCourseInformation() {
  var courseInfo = prompt("Hit Ctrl+V to paste course information here.");

  if (courseInfo) {
    courseInfo = parseCourseInformation(courseInfo);
  }

  return courseInfo;
}

//
// parseCourseInformation
//
// @param text - the slide information that the user copied and pasted from
// the slide that is bugged
function parseCourseInformation(text) {
  var courseInfo = {
    slideInfo    : '',
    sectionTitle : ''
  };

  var splitText = text.split('---');

  courseInfo.slideInfo    = splitText[0].trim();
  courseInfo.sectionTitle = splitText[1].trim();

  return courseInfo;
}

//
// parseComponents
//
// @param slideID - the identification number that is copied
// and pasted from the help button inside of slides where
// bugs are identified. e.g. AD12-104-Web01-6-0-00-10
// 
function parseComponents(slideID) {
  var components = {
      webNumber      : '',
      courseName     : '',
      courseNumber   : '',
      programCode    : '',
      programVersion : ''
  };

  var splitString = '';

  // e.g. AD
  components.programCode = slideID.match(/^\w{2}/i);
  splitString += components.programCode;
  console.log('program code: ' + components.programCode);

  // e.g. 12
  components.programVersion = slideID.split(splitString)[1].match(/^\d{2}/i);
  splitString += components.programVersion + '-';
  console.log('program version: ' + components.programVersion);

  // e.g. 104
  components.courseNumber = slideID.split(splitString)[1].match(/^\d{3}/i);
  splitString += components.courseNumber + '-Web';
  console.log('course number: ' + components.courseNumber);

  // e.g. Web01
  components.webNumber = slideID.split(splitString)[1].match(/^\d{2,}/i);
  console.log('web number: ' + components.webNumber);

  components = verifyComponents(components);

  return components;
}

//
// verifyComponents
//
// @param components - an object generated by the parseComponents
// function that contains all of the parsed information from the
// slideID given by the user
function verifyComponents(components) {
  var return_value = components;
  for (var i = 0; i < components.length; i++) {
    if (!components[i]) {
      return_value = null;
    }
  }
  return return_value;
}

//
// addTag
//
// @param tag - a string representation of the tag to be added
function addTag(tag) {
  var $input        = '';
  var $addButton    = $('.tag-box.tag-box-selectable');
  var pressEnterKey = $.Event('keydown', { keyCode : 13 });

  $addButton.click();
  $input = $('.tags-input.tag-box.ui-autocomplete-input');

  $input.val(tag);
  $input.trigger(pressEnterKey);
}

//
// addTitle
//
// @param title - a string representation of the title to be added
function addTitle(title) {
  var $titleInput = $('.dialog input[aria-label="Title"]');
  $titleInput.val(title + ' - ');
  $titleInput.focus();
}

// MAIN
// scope this stuff
(
  function() {
    var courseInfo   = promptCourseInformation();

    if (courseInfo) {
      var tagOne, tagTwo;
      var slideID      = courseInfo.slideInfo;
      var sectionTitle = courseInfo.sectionTitle;
      var components   = parseComponents(slideID);
    }

    // Do nothing if components are null; that means the
    // data provided was invalid
    if (!components) {
      alert('That data was invalid!');
    }
    else {
      tagOne = components.programCode    +
               components.programVersion +
               '-'                       +
               components.courseNumber;

      tagTwo = 'Web' + components.webNumber + '-' + sectionTitle;

      addTag(tagOne);
      addTag(tagTwo);
      addTitle(slideID);
    }
  }
)();

(function(qa_helper) {

	$("#button1").on("click", function(){
		
	});

	$("#button2").on("click", function(){
				
	});

	$("#button3").on("click", function(){
				
	});

})();
(function() {
  // TODO: define css
  var css = 'body { width: 200px !important; }';

  var style       = document.createElement('style');
  style.innerHTML = css;

  document.head.appendChild(style);
})();

(function()  { 

  var $btn_support = $("#btn-support");

  //click the question mark button on navigation menu to change the slideID
  //click again to close the popup modal
	$btn_support.click(); 
	$btn_support.click();

  //grab slide information
	var full_reference_id = $("div#lightboxBody>p:nth-of-type(2)").text().slice(0, -1);
	var scoName = $('#scoName').text();

  //have user copy slide info
	prompt("Press Ctrl+C to copy to clipboard", full_reference_id + " --- " + scoName); 

})()
(function() {

	var navigate_slides = function(){

		this.select_slide = function(){
			
      //lets you choose the slide to go to
			var slide_reference = prompt("Please enter the 3 number sequence of the slide you want to go to (last three numbers)", "1-01-1"); 
			loadSlideByReferenceId(slide_reference); 
      return this;

		};

		//takes you to the next slide
		this.next_slide = function(){
			loadNextSlide();
      return this;
		};

		//takes you to the previous slide
		this.prev_slide = function(){
			loadPrevSlide();
      return this;
		};
	}

})();


(function() { var css = '#footer-bar{display:flex;justify-content:space-around;background-color:red}#grabbable{height:20px;background-color:red;border:solid black 1px;text-align:center;cursor:move}.footer-bar-box{position:absolute;bottom:0;left:0}.footer-button{border:solid black 1px;padding:0 10px;text-align:center;cursor:pointer}';var style = document.createElement('style');style.innerHTML = css;document.head.appendChild(style);})();
$(function() {
             
    var qa_helper = {};

    // returns view object
    qa_helper.view = function() {
        
        var $drag_box = $("#draggable");

        this.addToDocument = function() {
            $("body").append(this.element);
        };

        this.removeFromDocument = function() {
            $drag_box.remove(this.element);
        };

        this.toggle_visibility = function() {
             $drag_box.toggle();
        };

        //template for the elements to load to the page
        this.element = `<div class="footer-bar-box" id="draggable">

                            <div id="grabbable">Drag Icon</div>

                            <div id="footer-bar">

                                <div class="footer-button">
                                    <p>Course #</p>
                                </div>

                                <div class="footer-button">
                                    <p>Title & Tag</p>
                                </div>

                                <div class="footer-button">
                                    <p>Navigate</p>
                                </div>

                            </div>

                        </div>`;

        return this;
    }

    //give the window access to qa_helper's functions
    window.qa_helper = qa_helper;

    //add element to the page
    qa_helper.view().addToDocument();
     
    //make the element draggable
    $( "#draggable" ).draggable();
     
 });